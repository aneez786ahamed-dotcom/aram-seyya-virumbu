<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aram Seyya Virumbu – Ramadan 2026</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body { background: linear-gradient(120deg,#1e3a8a,#020617); }
</style>
</head>

<body class="min-h-screen text-white p-6">

<!-- ================= LOGIN ================= -->
<div id="loginBox" class="max-w-sm mx-auto bg-white/10 p-4 rounded-xl">
  <h2 class="text-xl font-bold text-center mb-3">Login</h2>

  <select id="role" class="w-full p-2 text-black rounded mb-2">
    <option value="">Select Role</option>
    <option value="volunteer">Volunteer</option>
    <option value="host">Host</option>
  </select>

  <input id="username" placeholder="Username"
    class="w-full p-2 rounded text-black mb-2" />

  <input id="password" type="password" placeholder="Password"
    class="w-full p-2 rounded text-black mb-3" />

  <button onclick="login()"
    class="bg-blue-600 w-full py-2 rounded font-semibold">
    Enter
  </button>
</div>

<!-- ================= VOLUNTEER PORTAL ================= -->
<div id="volunteerPortal" class="hidden max-w-6xl mx-auto">

  <h1 class="text-3xl font-bold text-center mb-4">
    Aram Seyya Virumbu – Ramadan 2026
  </h1>

  <!-- CALENDAR -->
  <div class="bg-white/10 rounded-xl p-4 mb-6">
    <h2 class="text-xl font-semibold mb-3">Book a Date</h2>
    <div id="calendar" class="grid grid-cols-2 md:grid-cols-5 gap-3"></div>
  </div>

  <!-- BENEFICIARIES -->
  <div class="bg-white/10 rounded-xl p-4">
    <h2 class="text-xl font-semibold mb-3">
      Enter Beneficiaries (Completed Days)
    </h2>
    <div id="beneficiaryList" class="space-y-2"></div>
  </div>

</div>

<!-- ================= HOST PORTAL ================= -->
<div id="hostPortal" class="hidden max-w-4xl mx-auto mt-6">
  <h2 class="text-2xl font-bold mb-3">Host Controls</h2>
  <button onclick="clearAllBookings()"
    class="bg-red-600 px-4 py-2 rounded">
    Clear All Bookings
  </button>
</div>

<!-- ================= MODAL ================= -->
<div id="modal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center">
  <div class="bg-white text-black rounded-xl p-6 w-80">
    <h3 class="text-lg font-bold mb-2">Add Your Name</h3>
    <p id="selectedDate" class="mb-2"></p>
    <input id="nameInput"
      class="border w-full p-2 rounded mb-3"
      placeholder="Your Name" />
    <button onclick="saveBooking()"
      class="bg-blue-600 text-white w-full py-2 rounded">
      Confirm
    </button>
    <button onclick="closeModal()"
      class="text-sm mt-2 w-full">Cancel</button>
  </div>
</div>

<script>
/* ================= FIREBASE CONFIG ================= */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_DOMAIN",
  databaseURL: "YOUR_DB_URL",
  projectId: "YOUR_PROJECT_ID",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ================= LOGIN LOGIC ================= */
let CURRENT_ROLE = null;

const HOST_USERS = [
  { user: "Chairman", pass: "Yunus" },
  { user: "RACNC", pass: "golden jubilee" }
];

function login() {
  const role = document.getElementById("role").value;
  const u = username.value.trim();
  const p = password.value.trim();

  if (!role || !u || !p) return alert("Fill all fields");

  if (role === "host") {
    const ok = HOST_USERS.some(h => h.user === u && h.pass === p);
    if (!ok) return alert("Invalid host login");
    CURRENT_ROLE = "host";
  } else {
    CURRENT_ROLE = "volunteer";
  }

  loginBox.style.display = "none";
  volunteerPortal.classList.remove("hidden");
  if (CURRENT_ROLE === "host") hostPortal.classList.remove("hidden");

  generateCalendar();
  loadBeneficiaries();
}

/* ================= CALENDAR ================= */
const startDate = new Date("2026-02-17");
const totalDays = 30;
let chosenDateKey = null;

function generateCalendar() {
  calendar.innerHTML = "";

  for (let i = 0; i < totalDays; i++) {
    const d = new Date(startDate);
    d.setDate(d.getDate() + i);
    const key = d.toISOString().split("T")[0];

    const box = document.createElement("div");
    box.className = "p-3 rounded-xl text-center cursor-pointer bg-green-500";
    box.innerHTML = `
      ${d.toDateString()}
      <div class="text-xs mt-1" id="name-${key}">Available</div>
    `;

    box.onclick = () => openModal(key, d.toDateString());
    calendar.appendChild(box);

    db.ref("bookings/" + key).on("value", snap => {
      const data = snap.val();
      const nameDiv = document.getElementById("name-" + key);

      if (data) {
        const names = Object.values(data);
        nameDiv.innerText = "By: " + names.join(", ");
        box.classList.replace("bg-green-500", "bg-yellow-500");
      }
    });
  }
}

function openModal(key, label) {
  chosenDateKey = key;
  selectedDate.innerText = label;
  modal.classList.remove("hidden");
}

function closeModal() {
  modal.classList.add("hidden");
}

function saveBooking() {
  const name = nameInput.value.trim();
  if (!name) return alert("Enter name");
  db.ref("bookings/" + chosenDateKey).push(name);
  nameInput.value = "";
  closeModal();
}

/* ================= BENEFICIARIES ================= */
function loadBeneficiaries() {
  const today = new Date().toISOString().split("T")[0];
  beneficiaryList.innerHTML = "";

  db.ref("bookings").once("value", snap => {
    const data = snap.val();
    if (!data) return;

    Object.keys(data).forEach(dateKey => {
      if (dateKey >= today) return;

      const div = document.createElement("div");
      div.className = "bg-white/10 p-3 rounded";

      div.innerHTML = `
        <div class="text-sm">${dateKey}</div>
        <input id="ben-${dateKey}" type="number"
          class="text-black w-full p-1 rounded mb-1"
          placeholder="No. of beneficiaries">
        <button onclick="saveBen('${dateKey}')"
          class="bg-green-600 w-full py-1 rounded">
          Save
        </button>
      `;
      beneficiaryList.appendChild(div);
    });
  });
}

function saveBen(dateKey) {
  const v = document.getElementById("ben-" + dateKey).value;
  if (!v || v <= 0) return alert("Enter valid number");
  db.ref("beneficiaries/" + dateKey).set(parseInt(v));
  alert("Saved");
}

/* ================= HOST ================= */
function clearAllBookings() {
  if (!confirm("Clear all bookings?")) return;
  db.ref("bookings").remove();
  location.reload();
}
</script>

</body>
</html>
